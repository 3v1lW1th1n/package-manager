# @TEST-REQUIRES: type bro-config
# @TEST-REQUIRES: test -n "$(bro-config --bro_dist)"

# @TEST-EXEC: bash %INPUT
# @TEST-EXEC: bro-pkg install rot13

# @TEST-EXEC: btest-diff plugins/packages/rot13/__bro_plugin__ 
# @TEST-EXEC: btest-diff scripts/packages/rot13/__load__.bro 

# Unloading the package should also disable the plugin, which we
# detect via the renamed __bro_plugin__ magic file.
# @TEST-EXEC: bro-pkg unload rot13

# @TEST-EXEC: test ! -f plugins/packages/rot13/__bro_plugin__
# @TEST-EXEC: btest-diff plugins/packages/rot13/__bro_plugin__.disabled

# (Re-)loading the package should also (re-)enable the plugin.
# @TEST-EXEC: bro-pkg load rot13

# @TEST-EXEC: test ! -f plugins/packages/rot13/__bro_plugin__.disabled
# @TEST-EXEC: cp plugins/packages/rot13/__bro_plugin__  __bro_plugin__.after_enabling
# @TEST-EXEC: btest-diff __bro_plugin__.after_enabling

echo "$(pwd)/packages/rot13" >> sources/one/bob/bro-pkg.index
cd sources/one
git commit -am 'add rot13 package'
